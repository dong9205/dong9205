<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>文档 - 分类 - 爱好知识分享与记录</title><link>https://example.com/categories/documentation/</link><description>文档 - 分类 - 爱好知识分享与记录</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>920506213@qq.com (董大轩)</managingEditor><webMaster>920506213@qq.com (董大轩)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Fri, 11 Oct 2024 20:52:22 +0800</lastBuildDate><atom:link href="https://example.com/categories/documentation/" rel="self" type="application/rss+xml"/><item><title>Kubeadm高可用集群</title><link>https://example.com/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/</link><pubDate>Thu, 30 Nov 2023 17:56:35 +0800</pubDate><author>Derrick</author><guid>https://example.com/kubeadm%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/</guid><description>kubeadm 使用静态POD启动KeepAlived和Haproxy</description></item><item><title>单点登录报错记录</title><link>https://example.com/ssoerror/</link><pubDate>Fri, 11 Oct 2024 20:52:22 +0800</pubDate><author>Derrick</author><guid>https://example.com/ssoerror/</guid><description><![CDATA[<h1 id="saml登录异常错误记录">SAML登录异常错误记录</h1>
<h2 id="missing-signature-referencing-the-top-level-element">Missing signature referencing the top-level element</h2>
<h3 id="原因">原因</h3>
<p>使用的Google的Saml协议接入单点登录, 后端配置了验证，需要勾选&quot;<strong>已签署响应复选框</strong>&quot;</p>
<h3 id="排查细节">排查细节</h3>
<ol>
<li>首先通过报错发现了具体的错误函数，发现是通过调用了goxmldsig.NewDefaultValidationContext创建的ValidationContext结构体ctx,然后ctx的Validate函数的报错</li>
<li>继续Debug，发现是findSignature下sig的结果为空，导致返回报错&quot;Missing signature referencing the top-level element&quot;</li>
<li>sig为空的原因是&quot;idAttr&quot;和&quot;ref.URI&quot;的不相同.</li>
<li>然后找到其他正常的请求发现XML里边有ds:Signature字段，但是Google的saml返回结果里边没有这个字段</li>
<li>然后在平台上找到&quot;<strong>已签署响应复选框</strong>&ldquo;选项</li>
</ol>]]></description></item><item><title>gost配置反向代理隧道</title><link>https://example.com/gost/</link><pubDate>Wed, 11 Sep 2024 19:47:08 +0800</pubDate><author>Derrick</author><guid>https://example.com/gost/</guid><description><![CDATA[<h1 id="gost配置反向代理隧道">gost配置反向代理隧道</h1>
<h2 id="初始化">初始化</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /opt/go/src/github.com/go-gost
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /opt/go/src/github.com/go-gost
</span></span><span class="line"><span class="cl">git@github.com:go-gost/gost.git
</span></span><span class="line"><span class="cl">mkdir gost-plus
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> gost-plus/
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置gostyaml">配置gost.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">service-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="p">:</span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">handler</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">tunnel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p">:</span><span class="m">8000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ingress</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#scheme: https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listener</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ws</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ingresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ingress-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">plugin</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">grpc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l">gost-plugins:8000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置docker-composeyaml">配置docker-compose.yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gost-tunnel</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gogost/gost</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8081:8081&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8082:8082&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/opt/go/src/github.com/go-gost/gost-plus/gost-plus:/etc/gost/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gost-plugins</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">ginuerzh/gost-plugins</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ingress --addr=:8082 --redis.addr=redis:6379 --redis.db=2 --redis.expiration=24h --domain=gost.p-pp.cn --log.level=debug&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis:7.2.1-alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis-server --save 60 1 --loglevel warning&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="启动">启动</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置nginx">配置nginx</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /etc/nginx/sites-enabled/tunnel.gost.p-pp.cn.conf 
</span></span><span class="line"><span class="cl">upstream internal.infra.gost <span class="o">{</span>
</span></span><span class="line"><span class="cl">        server localhost:8081<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen 80<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server_name tunnel.gost.p-pp.cn<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="m">308</span> https://<span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen <span class="m">443</span> ssl<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server_name tunnel.gost.p-pp.cn<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_certificate gost-cert/tunnel.gost.p-pp.cn.pem<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_certificate_key gost-cert/tunnel.gost.p-pp.cn.key<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_protocols TLSv1.2<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_session_cache shared:SSL_WS2:500m<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_session_timeout 10m<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_prefer_server_ciphers on<span class="p">;</span>
</span></span><span class="line"><span class="cl">        access_log /var/log/nginx/tunnel.gost.p-pp.cn.access.log body_main<span class="p">;</span>
</span></span><span class="line"><span class="cl">        error_log /var/log/nginx/tunnel.gost.p-pp.cn.access.log<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">                proxy_pass_header server<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header host <span class="nv">$http_host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header x-real-ip <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header x-scheme <span class="nv">$scheme</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_http_version 1.1<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Connection keep-alive<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Keep-Alive 3600<span class="p">;</span>
</span></span><span class="line"><span class="cl">                keepalive_timeout 3600<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Connection <span class="s2">&#34;upgrade&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_pass http://internal.infra.gost<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat /etc/nginx/sites-enabled/gost.p-pp.cn.conf 
</span></span><span class="line"><span class="cl">upstream internal.infra.gost-plugin <span class="o">{</span>
</span></span><span class="line"><span class="cl">        server localhost:8082<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen 80<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server_name *.gost.p-pp.cn<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="m">308</span> https://<span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen <span class="m">443</span> ssl<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server_name *.gost.p-pp.cn<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_certificate gost-cert/tunnel.gost.p-pp.cn.pem<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_certificate_key gost-cert/tunnel.gost.p-pp.cn.key<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#ssl_certificate gost-cert/$ssl_server_name.pem;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#ssl_certificate_key gost-cert/$ssl_server_name.key;</span>
</span></span><span class="line"><span class="cl">        ssl_protocols TLSv1.2<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_session_cache shared:SSL_WS2:500m<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_session_timeout 10m<span class="p">;</span>
</span></span><span class="line"><span class="cl">        ssl_prefer_server_ciphers on<span class="p">;</span>
</span></span><span class="line"><span class="cl">        access_log /var/log/nginx/gost.p-pp.cn.access.log main<span class="p">;</span>
</span></span><span class="line"><span class="cl">        error_log /var/log/nginx/gost.p-pp.cn.access.log<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">                proxy_pass_header server<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header host <span class="nv">$http_host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header x-real-ip <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header x-scheme <span class="nv">$scheme</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_http_version 1.1<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Connection keep-alive<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Keep-Alive 3600<span class="p">;</span>
</span></span><span class="line"><span class="cl">                keepalive_timeout 3600<span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_set_header Connection <span class="s2">&#34;upgrade&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                proxy_pass http://internal.infra.gost-plugin<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置域名解析">配置域名解析</h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">域名</th>
          <th style="text-align: left">类型</th>
          <th style="text-align: left">地址</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">gost.p-pp.cn</td>
          <td style="text-align: left">CNAME</td>
          <td style="text-align: left">host02.p-pp.cn</td>
      </tr>
      <tr>
          <td style="text-align: left">*.gost.p-pp.cn</td>
          <td style="text-align: left">CNAME</td>
          <td style="text-align: left">host02.p-pp.cn</td>
      </tr>
  </tbody>
</table>
<h2 id="客户端下载">客户端下载</h2>
<blockquote>
<p><a href="https://github.com/go-gost/gost/releases" target="_blank" rel="noopener noreffer ">https://github.com/go-gost/gost/releases</a></p>]]></description></item><item><title>部署Headscale</title><link>https://example.com/headscale_deploy/</link><pubDate>Tue, 10 Sep 2024 10:29:30 +0800</pubDate><author>Derrick</author><guid>https://example.com/headscale_deploy/</guid><description><![CDATA[<h1 id="服务端">服务端</h1>
<h2 id="部署">部署</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /opt/go/src/github.com/juanfont
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /opt/go/src/github.com/juanfont
</span></span><span class="line"><span class="cl">git clone https://github.com/juanfont/headscale.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> headscale
</span></span><span class="line"><span class="cl">mkdir config
</span></span><span class="line"><span class="cl">touch config/db.sqlite
</span></span><span class="line"><span class="cl">cp config-example.yaml config/config.yaml
</span></span><span class="line"><span class="cl">vim config/config.yaml 
</span></span><span class="line"><span class="cl">docker run --name<span class="o">=</span>headscale --user<span class="o">=</span><span class="m">0</span> --volume<span class="o">=</span>/opt/go/src/github.com/juanfont/headscale/config:/etc/headscale/ --workdir<span class="o">=</span>/ -p 8080:8080 -p 9090:9090 --restart<span class="o">=</span>always --runtime<span class="o">=</span>runc --detach<span class="o">=</span><span class="nb">true</span> headscale/headscale:v0.23.0-beta.4 serve
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;alias headscale=&#39;docker container exec headscale headscale&#39;&#34;</span> &gt;&gt; ~/.bashrc <span class="o">&amp;&amp;</span> . ~/.bashrc
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="配置用户">配置用户</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">headscale user create test01
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="客户端">客户端</h1>
<h2 id="安装客户端">安装客户端</h2>
<blockquote>
<p><a href="https://tailscale.com/download" target="_blank" rel="noopener noreffer ">https://tailscale.com/download</a></p>]]></description></item><item><title>Kubernetes 1.27升级至1.28</title><link>https://example.com/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/</link><pubDate>Fri, 23 Aug 2024 21:15:18 +0800</pubDate><author>Derrick</author><guid>https://example.com/1.27%E5%8D%87%E7%BA%A7%E8%87%B31.28/</guid><description><![CDATA[<h2 id="介绍">介绍</h2>
<p>之前升级都是直接使用阿里云的控制台，只知道升级了控制面，然后升级了节点，但是不知道其中的更多细节，所以自己在测试环境升级学习下, 升级的话直接按照官方文档升级即可: <a href="https://v1-28.docs.kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/#upgrading-control-plane-nodes" target="_blank" rel="noopener noreffer ">https://v1-28.docs.kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/#upgrading-control-plane-nodes</a>, 我这里主要记录下命令和遇到的问题</p>]]></description></item><item><title>发版内容diff</title><link>https://example.com/diff/</link><pubDate>Tue, 30 Jul 2024 10:26:40 +0800</pubDate><author>Derrick</author><guid>https://example.com/diff/</guid><description><![CDATA[<h1 id="发版内容diff">发版内容diff</h1>
<h2 id="前端">前端</h2>
<blockquote>
<p><a href="https://github.com/otakustay/react-diff-view.git" target="_blank" rel="noopener noreffer ">https://github.com/otakustay/react-diff-view.git</a></p>
</blockquote>
<h3 id="介绍">介绍</h3>
<p>该工具是将git diff的结果进行解析，然后对不同的内容进行渲染，从而实现git diff的展示。</p>
<h2 id="后端">后端</h2>
<blockquote>
<p><a href="https://github.com/go-git/go-git.git" target="_blank" rel="noopener noreffer ">https://github.com/go-git/go-git.git</a></p>
</blockquote>
<p>该工具实现了git diff的功能，首先调用go-diff对两份数据进行diff，然后最结果进行解析，解析为git diff一样的效果</p>]]></description></item><item><title>单个目录下文件爆满</title><link>https://example.com/directory-index-full/</link><pubDate>Thu, 30 May 2024 20:34:24 +0800</pubDate><author>Derrick</author><guid>https://example.com/directory-index-full/</guid><description><![CDATA[<h1 id="报错">报错</h1>
<h2 id="创建文件报错">创建文件报错</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">No space left on device
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="syslog日志错误">syslog日志错误</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Directory <span class="o">(</span>ino: 4230742<span class="o">)</span> index full, reach max htree level :2
</span></span><span class="line"><span class="cl">Large directory feature is not enabled on this filesystem
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="背景">背景</h1>
<ol>
<li>在data目录下无法创建file-1, 但是可以创建file-2, 通过<code>df -hT</code> 和 <code>df -hi</code>确认不是磁盘不足、不是inode不足导致</li>
<li>经过排查是因为目录下的文件超过了目录文件限制.  但是删除一些文件后，创建file-1还是报错</li>
<li>话说重启解决99%的问题，所以我重启发现这是剩余的1%的问题.</li>
</ol>
<h2 id="出现问题的原因">出现问题的原因</h2>
<ul>
<li>ext4自身没有做相关方面的限制</li>
<li>Linux 2.6.23以后引入的HTree索引做的，2-level HTree索引限定了约10-12 million（百万）</li>
<li>Linux 4.12后largedir特性开启的话3-level限定了约6 billion（十亿）</li>
</ul>
<p><a href="https://en.wikipedia.org/wiki/Ext4" target="_blank" rel="noopener noreffer ">https://en.wikipedia.org/wiki/Ext4</a></p>]]></description></item><item><title>将Mysql查询内容转换为JSON</title><link>https://example.com/json-format/</link><pubDate>Thu, 30 May 2024 20:25:28 +0800</pubDate><author>Derrick</author><guid>https://example.com/json-format/</guid><description><![CDATA[<h1 id="安装命令">安装命令</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install csvkit mycli
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="打印json格式">打印JSON格式</h1>
<h2 id="在mycli终端中打印">在Mycli终端中打印</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> $ mycli -P <span class="m">3306</span> -proot mysql
</span></span><span class="line"><span class="cl">MySQL root@localhost:mysql&gt; <span class="se">\T</span> csv
</span></span><span class="line"><span class="cl">MySQL root@localhost:mysql&gt; pager csvjson <span class="p">|</span> jq <span class="s1">&#39;.&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="在linux命令行打印">在Linux命令行打印</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mycli -P <span class="m">3306</span> -proot mysql --csv -e <span class="s2">&#34;select * from user;&#34;</span> <span class="p">|</span> csvjson <span class="p">|</span> jq .
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="参考连接">参考连接</h1>
<p><a href="https://github.com/dbcli/mycli/issues/753#issuecomment-504279817" target="_blank" rel="noopener noreffer ">https://github.com/dbcli/mycli/issues/753#issuecomment-504279817</a></p>]]></description></item><item><title>React Antd ProTable滚动更新</title><link>https://example.com/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/</link><pubDate>Thu, 11 Apr 2024 13:12:40 +0800</pubDate><author>Derrick</author><guid>https://example.com/protable%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/</guid><description><![CDATA[<h1 id="react-antd-protable-expandableexpandedrowrender支持滚动更新">React Antd ProTable expandable.expandedRowRender支持滚动更新</h1>
<h2 id="需求介绍">需求介绍</h2>
<p>报警平台需要展示各个报警的事件，相同的报警标题会被聚合在一起，但是会记录每次报警内容作为事件展示，有时候出现几百万次报警，导致前端加载缓慢，所以考虑报警事件使用滚动加载的方式获取</p>]]></description></item><item><title>部署k8s多集群管理利器Karmada</title><link>https://example.com/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/</link><pubDate>Mon, 19 Feb 2024 14:54:29 +0800</pubDate><author>Derrick</author><guid>https://example.com/01%E9%83%A8%E7%BD%B2k8s%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%88%A9%E5%99%A8karmada/</guid><description><![CDATA[<h1 id="部署k8s多集群管理利器karmada">部署k8s多集群管理利器Karmada</h1>
<h2 id="创建两个kubernetes集群">创建两个kubernetes集群</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; cluster01-kind.yaml
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Cluster
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: kind.x-k8s.io/v1alpha4
</span></span></span><span class="line"><span class="cl"><span class="s">name: cluster01
</span></span></span><span class="line"><span class="cl"><span class="s">nodes:
</span></span></span><span class="line"><span class="cl"><span class="s">- role: control-plane
</span></span></span><span class="line"><span class="cl"><span class="s">networking:
</span></span></span><span class="line"><span class="cl"><span class="s">  podSubnet: &#34;10.10.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  serviceSubnet: &#34;10.11.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kind create cluster --config  cluster01-kind.yaml
</span></span><span class="line"><span class="cl">kubectl config set-cluster kind-cluster01 --server<span class="o">=</span>https://<span class="k">$(</span>docker inspect -f <span class="s1">&#39;{{.NetworkSettings.Networks.kind.IPAddress}}&#39;</span> cluster01-control-plane<span class="k">)</span>:6443
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; cluster02-kind.yaml
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Cluster
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: kind.x-k8s.io/v1alpha4
</span></span></span><span class="line"><span class="cl"><span class="s">name: cluster02
</span></span></span><span class="line"><span class="cl"><span class="s">nodes:
</span></span></span><span class="line"><span class="cl"><span class="s">- role: control-plane
</span></span></span><span class="line"><span class="cl"><span class="s">networking:
</span></span></span><span class="line"><span class="cl"><span class="s">  podSubnet: &#34;10.20.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  serviceSubnet: &#34;10.21.0.0/16&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kind create cluster --config  cluster02-kind.yaml
</span></span><span class="line"><span class="cl">kubectl config set-cluster kind-cluster02 --server<span class="o">=</span>https://<span class="k">$(</span>docker inspect -f <span class="s1">&#39;{{.NetworkSettings.Networks.kind.IPAddress}}&#39;</span> cluster02-control-plane<span class="k">)</span>:6443
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="karmada-kubectl-插件">Karmada kubectl 插件</h2>
<blockquote>
<p>kubectl-krew: <a href="https://krew.sigs.k8s.io/" target="_blank" rel="noopener noreffer ">https://krew.sigs.k8s.io/</a></p>]]></description></item></channel></rss>